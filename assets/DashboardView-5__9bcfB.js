import{u as B}from"./index-C8xB7GOY.js";import{g as S,a as u,b as j,i as z,j as n,k as t,t as o,m,l as f,c as I,n as k,x as p,r as V,F as R,y as L,o as a}from"./vue-vendor-C77FZFBx.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./supabase-D4wOtLzw.js";const F={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},H={class:"bg-white rounded-lg shadow-md p-6 mb-6"},N={class:"text-3xl font-bold text-gray-900"},T={class:"text-gray-600 mt-2"},E={class:"bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg shadow-md p-6 mb-6 text-white"},U={class:"flex items-center justify-between"},q={class:"mt-2 text-indigo-100"},G=["disabled"],J={key:1,class:"text-center"},K={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},O={class:"bg-white rounded-lg shadow-md p-6"},P={class:"flex items-center"},Q={class:"ml-4"},W={class:"text-2xl font-bold text-gray-900"},X={class:"bg-white rounded-lg shadow-md p-6"},Y={class:"flex items-center"},Z={class:"ml-4"},$={class:"text-2xl font-bold text-gray-900"},tt={class:"bg-white rounded-lg shadow-md p-6"},et={class:"flex items-center"},st={class:"ml-4"},ot={class:"text-2xl font-bold text-gray-900"},at={class:"bg-white rounded-lg shadow-md p-6"},nt={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"},it={class:"bg-white rounded-lg shadow-md p-6 mt-6"},rt={class:"space-y-4"},lt={class:"flex-1"},dt={class:"text-sm font-medium text-gray-900"},ct={class:"text-xs text-gray-500"},ut={key:0,class:"text-gray-500 text-sm text-center py-4"},gt=S({__name:"DashboardView",setup(mt){const{user:i,apiRequest:w,login:h}=B(),r=u(!1),l=u(!1),d=u({activeDevices:0,loginStreak:0}),c=u([]),y=j(()=>i.value?new Date().toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Неизвестно");z(async()=>{await v(),_()});async function v(){try{const e=await(await w("/devices/count",{method:"GET"})).json();d.value.activeDevices=e.count||0,d.value.loginStreak=C(),c.value=[{action:"Вход в систему",timestamp:"Сегодня, "+new Date().toLocaleTimeString("ru-RU")}]}catch(s){console.error("Failed to load dashboard data:",s)}}function _(){const s=localStorage.getItem("lastCheckIn"),e=new Date().toDateString();l.value=s===e}async function b(){r.value=!0;try{await h();const s=new Date().toDateString();localStorage.setItem("lastCheckIn",s),l.value=!0,c.value.unshift({action:"Ежедневная отметка",timestamp:"Только что"})}catch(s){console.error("Check-in failed:",s),alert("Ошибка при отметке")}finally{r.value=!1}}function C(){return Math.floor(Math.random()*30)+1}async function M(){try{await h(),await v()}catch(s){console.error("Refresh failed:",s)}}return(s,e)=>{const g=V("router-link");return a(),n("div",F,[t("div",H,[t("h1",N," Добро пожаловать, "+o(m(i)?.displayName)+"! ",1),t("p",T," Последний вход: "+o(y.value),1)]),t("div",E,[t("div",U,[t("div",null,[e[0]||(e[0]=t("h2",{class:"text-2xl font-bold"},"Ежедневная отметка",-1)),t("p",q,o(l.value?"Вы уже отметились сегодня!":"Отметьтесь, чтобы продолжить"),1)]),t("div",null,[l.value?(a(),n("div",J,[...e[1]||(e[1]=[t("svg",{class:"w-16 h-16 text-white mx-auto",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})],-1),t("p",{class:"mt-2 font-medium"},"Отмечено ✓",-1)])])):(a(),n("button",{key:0,onClick:b,disabled:r.value,class:"bg-white text-indigo-600 font-semibold px-6 py-3 rounded-lg hover:bg-indigo-50 transition disabled:opacity-50"},o(r.value?"Отметка...":"Отметиться"),9,G))])])]),t("div",K,[t("div",O,[t("div",P,[e[3]||(e[3]=t("div",{class:"p-3 bg-blue-100 rounded-lg"},[t("svg",{class:"w-8 h-8 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})])],-1)),t("div",Q,[e[2]||(e[2]=t("p",{class:"text-sm font-medium text-gray-600"},"Активных устройств",-1)),t("p",W,o(d.value.activeDevices),1)])])]),t("div",X,[t("div",Y,[e[5]||(e[5]=t("div",{class:"p-3 bg-green-100 rounded-lg"},[t("svg",{class:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t("div",Z,[e[4]||(e[4]=t("p",{class:"text-sm font-medium text-gray-600"},"Дней подряд",-1)),t("p",$,o(d.value.loginStreak),1)])])]),t("div",tt,[t("div",et,[e[7]||(e[7]=t("div",{class:"p-3 bg-purple-100 rounded-lg"},[t("svg",{class:"w-8 h-8 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),t("div",st,[e[6]||(e[6]=t("p",{class:"text-sm font-medium text-gray-600"},"Статус аккаунта",-1)),t("p",ot,o(m(i)?.role==="admin"?"Админ":"Активен"),1)])])])]),t("div",at,[e[12]||(e[12]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Быстрые действия",-1)),t("div",nt,[f(g,{to:"/profile",class:"flex items-center p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition"},{default:p(()=>[...e[8]||(e[8]=[t("svg",{class:"w-6 h-6 text-indigo-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1),t("span",{class:"font-medium text-gray-900"},"Профиль",-1)])]),_:1}),f(g,{to:"/devices",class:"flex items-center p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition"},{default:p(()=>[...e[9]||(e[9]=[t("svg",{class:"w-6 h-6 text-indigo-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1),t("span",{class:"font-medium text-gray-900"},"Устройства",-1)])]),_:1}),m(i)?.role==="admin"?(a(),I(g,{key:0,to:"/admin",class:"flex items-center p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition"},{default:p(()=>[...e[10]||(e[10]=[t("svg",{class:"w-6 h-6 text-indigo-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),t("span",{class:"font-medium text-gray-900"},"Админ-панель",-1)])]),_:1})):k("",!0),t("button",{onClick:M,class:"flex items-center p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition"},[...e[11]||(e[11]=[t("svg",{class:"w-6 h-6 text-indigo-600 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),t("span",{class:"font-medium text-gray-900"},"Обновить",-1)])])])]),t("div",it,[e[13]||(e[13]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Последняя активность",-1)),t("div",rt,[(a(!0),n(R,null,L(c.value,(x,D)=>(a(),n("div",{key:D,class:"flex items-start border-l-4 border-indigo-500 pl-4 py-2"},[t("div",lt,[t("p",dt,o(x.action),1),t("p",ct,o(x.timestamp),1)])]))),128)),c.value.length===0?(a(),n("p",ut," Нет активности ")):k("",!0)])])])}}}),ft=A(gt,[["__scopeId","data-v-bae66fb0"]]);export{ft as default};
