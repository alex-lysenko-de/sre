import{r as n,o as _,c as l,a as t,h as p,i as x,j as w,e as b,t as a,n as k,g as D,F as C,d as B,k as I,u as M,f as i,s as $}from"./index-CF_Kzzik.js";const N={class:"child-detail-view p-4"},V={key:0,class:"text-center py-10 text-indigo-600"},j={key:1,class:"bg-red-100 border border-red-400 text-red-700 p-4 rounded-lg mb-6"},E={key:2,class:"space-y-8"},L={class:"bg-white p-6 rounded-lg shadow-xl border-t-4 border-indigo-500"},S={class:"text-3xl font-bold mb-4"},A={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},F={class:"detail-item"},R={class:"text-lg font-semibold text-gray-900"},q={class:"detail-item"},z={class:"text-lg font-semibold text-gray-900"},H={class:"detail-item"},T={class:"detail-item"},G={class:"flex items-center space-x-2"},J={class:"text-lg font-semibold text-gray-900"},K={class:"mt-6 border-t pt-4"},O={class:"text-gray-700 italic"},P={key:0,class:"p-6 bg-gray-100 rounded-lg text-gray-600"},Q={key:1,class:"overflow-x-auto bg-white rounded-lg shadow-md"},U={class:"min-w-full divide-y divide-gray-200"},W={class:"bg-white divide-y divide-gray-200"},X={class:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900"},Y={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-700"},Z={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},tt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},ot={__name:"ChildDetailView",setup(et){const g=I(),v=b(),{fetchChildDetailsAndScans:y}=M(),s=n(null),m=n([]),u=n(!0),d=n(null),c=n(null),h=async()=>{if(c.value=g.params.id,!c.value){d.value="ID ребенка не указан.",u.value=!1;return}u.value=!0,d.value=null;try{const o=await y(c.value);s.value=o.child,m.value=o.scans}catch(o){d.value="Не удалось загрузить данные: "+o.message,s.value=null}finally{u.value=!1}},f=async()=>{if(!(!s.value||!confirm(`Вы уверены, что хотите отвязать браслет ${s.value.band_id} от ${s.value.name}?`)))try{const{error:o}=await $.from("children").update({band_id:null}).eq("id",c.value);if(o)throw new Error(o.message);alert(`Браслет ${s.value.band_id} отвязан.`),s.value.band_id=null}catch(o){alert(`Ошибка отвязки: ${o.message}`),console.error(o)}};return _(h),(o,e)=>(i(),l("div",N,[t("button",{onClick:e[0]||(e[0]=r=>w(v).push("/main/children")),class:"mb-4 text-indigo-600 hover:text-indigo-800 flex items-center font-medium"},[...e[1]||(e[1]=[t("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),x(" К списку детей ",-1)])]),u.value?(i(),l("div",V,"Загрузка данных...")):d.value?(i(),l("div",j,[e[2]||(e[2]=t("strong",{class:"font-bold"},"Ошибка:",-1)),x(" "+a(d.value),1)])):s.value?(i(),l("div",E,[t("div",L,[t("h3",S,a(s.value.name),1),t("div",A,[t("div",F,[e[3]||(e[3]=t("p",{class:"text-sm font-medium text-gray-500"},"Возраст",-1)),t("p",R,a(s.value.age)+" лет",1)]),t("div",q,[e[4]||(e[4]=t("p",{class:"text-sm font-medium text-gray-500"},"Группа",-1)),t("p",z,a(s.value.group_id||"Не указана"),1)]),t("div",H,[e[5]||(e[5]=t("p",{class:"text-sm font-medium text-gray-500"},"Статус",-1)),t("p",{class:k(["text-lg font-semibold",s.value.schwimmer?"text-green-600":"text-red-600"])},a(s.value.schwimmer?"Пловец 🏊":"Не пловец"),3)]),t("div",T,[e[7]||(e[7]=t("p",{class:"text-sm font-medium text-gray-500"},"Браслет ID",-1)),t("div",G,[t("p",J,a(s.value.band_id||"Не привязан"),1),s.value.band_id?(i(),l("button",{key:0,onClick:D(f,["stop"]),title:"Отвязать браслет",class:"text-red-500 hover:text-red-700 transition-colors"},[...e[6]||(e[6]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):p("",!0)])])]),t("div",K,[e[8]||(e[8]=t("p",{class:"text-sm font-medium text-gray-500"},"Заметки",-1)),t("p",O,a(s.value.notes||"Заметок нет."),1)])]),e[11]||(e[11]=x(" --- ",-1)),t("div",null,[e[10]||(e[10]=t("h4",{class:"text-2xl font-semibold mb-4"},"История сканирования",-1)),m.value.length===0?(i(),l("div",P," Нет записей сканирования для этого ребенка. ")):(i(),l("div",Q,[t("table",U,[e[9]||(e[9]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Дата и время"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Тип скана"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"ID Сотрудника"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Bus ID")])],-1)),t("tbody",W,[(i(!0),l(C,null,B(m.value,r=>(i(),l("tr",{key:r.id},[t("td",X,a(new Date(r.created_at).toLocaleString()),1),t("td",Y,a(r.type_name),1),t("td",Z,a(r.user_id||"N/A"),1),t("td",tt,a(r.bus_id||"—"),1)]))),128))])])]))])])):p("",!0)]))}};export{ot as default};
