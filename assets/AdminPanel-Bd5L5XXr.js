import{g as j,a as i,i as B,j as l,k as t,n as f,p as y,z as b,A as x,t as n,F as U,y as z,B as h,o as a}from"./vue-vendor-C77FZFBx.js";import{u as Q}from"./index-C8xB7GOY.js";import{g as S}from"./supabase-D4wOtLzw.js";import{r as T}from"./qrcode-DpynCwP9.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";var D=T();const E=S(D),M={class:"min-h-screen bg-gray-50 py-8 px-4"},A={class:"max-w-4xl mx-auto"},I={class:"bg-white rounded-lg shadow-md p-6 mb-6"},q={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},H=["disabled"],N={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24"},O={key:1},P={key:2},L={key:0,class:"bg-white rounded-lg shadow-md p-6 mb-6"},$={class:"flex flex-col items-center"},G={class:"bg-white p-6 rounded-lg border-4 border-indigo-600 mb-4"},J={class:"w-full mb-4"},K={class:"flex"},W=["value"],X={class:"w-full bg-blue-50 border border-blue-200 rounded-lg p-4"},Y={class:"flex items-start"},Z={class:"flex-1"},tt={class:"mt-2 text-sm text-blue-800 space-y-1"},et={class:"bg-white rounded-lg shadow-md p-6"},st={class:"overflow-x-auto"},ot={class:"w-full"},lt={class:"divide-y divide-gray-200"},nt={class:"px-4 py-3 text-sm text-gray-900"},at={class:"px-4 py-3 text-sm"},rt={class:"px-4 py-3 text-sm text-gray-600"},it={class:"px-4 py-3 text-sm"},dt={class:"px-4 py-3 text-sm"},ut=["onClick"],pt=j({__name:"AdminPanel",setup(ct){const{apiRequest:c}=Q(),p=i("user"),m=i(24),d=i(!1),r=i(null),u=i(null),g=i([]);B(()=>{F()});async function w(){d.value=!0;try{const e=await(await c("/invite/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:p.value,expiresInHours:m.value})})).json();r.value={...e,role:p.value},await _(e.inviteUrl)}catch(s){console.error("Failed to generate invite:",s),alert("Ошибка при создании invite")}finally{d.value=!1}}async function _(s){if(u.value)try{await E.toCanvas(u.value,s,{width:256,margin:2,color:{dark:"#4F46E5",light:"#FFFFFF"}})}catch(e){console.error("Failed to generate QR code:",e)}}async function k(){if(!u.value)return;const s=document.createElement("a");s.download=`invite-qr-${Date.now()}.png`,s.href=u.value.toDataURL(),s.click()}function C(s){navigator.clipboard.writeText(s).then(()=>{alert("Скопировано в буфер обмена!")})}async function F(){try{const e=await(await c("/users",{method:"GET"})).json();g.value=e.users||[]}catch(s){console.error("Failed to load users:",s)}}async function R(s){try{await c("/user/toggle-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:s.id,active:!s.active})}),s.active=!s.active}catch(e){console.error("Failed to toggle user status:",e),alert("Ошибка при изменении статуса пользователя")}}function v(s){return new Date(s).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}return(s,e)=>(a(),l("div",M,[t("div",A,[e[20]||(e[20]=t("div",{class:"bg-white rounded-lg shadow-md p-6 mb-6"},[t("h1",{class:"text-3xl font-bold text-gray-900"},"Админ-панель"),t("p",{class:"text-gray-600 mt-2"},"Управление пользователями и генерация QR-кодов")],-1)),t("div",I,[e[8]||(e[8]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Создать Invite",-1)),t("div",q,[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Роль ",-1)),y(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>p.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},[...e[3]||(e[3]=[t("option",{value:"user"},"Пользователь",-1),t("option",{value:"admin"},"Администратор",-1)])],512),[[b,p.value]])]),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Срок действия ",-1)),y(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>m.value=o),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},[...e[5]||(e[5]=[t("option",{value:1},"1 час",-1),t("option",{value:24},"24 часа",-1),t("option",{value:72},"3 дня",-1),t("option",{value:168},"7 дней",-1)])],512),[[b,m.value]])])]),t("button",{onClick:w,disabled:d.value,class:"w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"},[d.value?(a(),l("svg",N,[...e[7]||(e[7]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):f("",!0),d.value?(a(),l("span",P,"Генерация...")):(a(),l("span",O,"Создать QR-код"))],8,H)]),r.value?(a(),l("div",L,[e[17]||(e[17]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"QR-код сгенерирован",-1)),t("div",$,[t("div",G,[t("canvas",{ref_key:"qrCanvas",ref:u,class:"w-64 h-64"},null,512)]),t("div",J,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Ссылка для регистрации ",-1)),t("div",K,[t("input",{value:r.value.inviteUrl,readonly:"",class:"flex-1 px-4 py-2 border border-gray-300 rounded-l-lg bg-gray-50 text-sm"},null,8,W),t("button",{onClick:e[2]||(e[2]=o=>C(r.value.inviteUrl)),class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-r-lg transition",title:"Копировать"},[...e[9]||(e[9]=[t("svg",{class:"w-5 h-5 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])])])]),t("div",X,[t("div",Y,[e[15]||(e[15]=t("svg",{class:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),t("div",Z,[e[14]||(e[14]=t("h4",{class:"text-sm font-medium text-blue-900"},"Информация",-1)),t("ul",tt,[t("li",null,[e[11]||(e[11]=x("• Роль: ",-1)),t("strong",null,n(r.value.role==="admin"?"Администратор":"Пользователь"),1)]),t("li",null,[e[12]||(e[12]=x("• Истекает: ",-1)),t("strong",null,n(v(r.value.expiresAt)),1)]),e[13]||(e[13]=t("li",null,"• Можно использовать только один раз",-1))])])])]),t("button",{onClick:k,class:"mt-4 px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition flex items-center"},[...e[16]||(e[16]=[t("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),x(" Скачать QR-код ",-1)])])])])):f("",!0),t("div",et,[e[19]||(e[19]=t("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Пользователи",-1)),t("div",st,[t("table",ot,[e[18]||(e[18]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Имя"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Роль"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Последний вход"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Статус"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Действия")])],-1)),t("tbody",lt,[(a(!0),l(U,null,z(g.value,o=>(a(),l("tr",{key:o.id,class:"hover:bg-gray-50"},[t("td",nt,n(o.display_name),1),t("td",at,[t("span",{class:h([o.role==="admin"?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800","px-2 py-1 rounded-full text-xs font-medium"])},n(o.role==="admin"?"Админ":"Пользователь"),3)]),t("td",rt,n(o.last_seen_date?v(o.last_seen_date):"Никогда"),1),t("td",it,[t("span",{class:h([o.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 rounded-full text-xs font-medium"])},n(o.active?"Активен":"Заблокирован"),3)]),t("td",dt,[t("button",{onClick:mt=>R(o),class:"text-indigo-600 hover:text-indigo-900 font-medium"},n(o.active?"Заблокировать":"Активировать"),9,ut)])]))),128))])])])])])]))}}),bt=V(pt,[["__scopeId","data-v-acae80aa"]]);export{bt as default};
