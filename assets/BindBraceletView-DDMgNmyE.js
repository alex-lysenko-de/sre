import{_ as I,r as d,l as M,o as S,c as v,a as l,i as x,t as i,n as f,b,m as T,F as U,d as q,g as E,v as w,p as N,j as D,e as F,k as A,u as R,f as g}from"./index-M_r4Q81N.js";const j={class:"bind-bracelet-view p-4"},z={key:0,class:"text-indigo-600"},L={key:1},W={class:"font-bold"},G={class:"p-6 border rounded-lg shadow-md mb-6 bg-white"},H=["value"],J=["disabled"],K={class:"p-6 border rounded-lg shadow-md bg-white"},O={class:"flex items-center"},P=["disabled"],Q={__name:"BindBraceletView",setup(X){const h=A(),p=F(),{createChildAndBind:k,bindBraceletToExistingChild:C,fetchAllChildren:B}=R(),n=d(null),c=d(!0),s=d(""),y=d([]),r=d(null),u=d(!1),o=M({name:"",age:0,schwimmer:!1,group_id:1}),m=d(!1),V=async()=>{const a=h.query.n;if(!a){s.value="Ошибка: Код браслета не найден для привязки.",c.value=!1;return}const e=BigInt(a);if(e<=0){s.value="Ошибка: Некорректный код браслета.",c.value=!1;return}n.value=e,s.value=`Готовность к привязке браслета: ${n.value}`,y.value=await B(),c.value=!1},_=async()=>{if(!r.value||!n.value){s.value="Выберите ребенка для привязки.";return}u.value=!0,s.value=`Привязка браслета ${n.value} к ребенку...`;try{const a=await C(r.value,n.value);s.value=`✅ Успех! Браслет привязан к ${a.name}.`,p.replace({path:"/main/scan",query:{n:n.value.toString()}})}catch(a){s.value=`Ошибка привязки: ${a.message}`,console.error(a)}finally{u.value=!1}},$=async()=>{if(!o.name||!n.value){s.value="Заполните имя и убедитесь, что код браслета присутствует.";return}m.value=!0,s.value=`Создание ребенка и привязка браслета ${n.value}...`;try{const a=await k(o,n.value);s.value=`✅ Успех! Создан ${a.name} и привязан браслет.`,p.replace({path:"/main/scan",query:{n:n.value.toString()}})}catch(a){s.value=`Ошибка создания: ${a.message}`,console.error(a)}finally{m.value=!1}};return S(V),(a,e)=>(g(),v("div",j,[e[14]||(e[14]=l("h3",{class:"text-xl font-semibold mb-4"},"Привязка браслета",-1)),c.value?(g(),v("div",z,"Загрузка данных...")):(g(),v("div",L,[l("div",{class:f(["p-3 rounded-lg mb-6",s.value.startsWith("Ошибка")?"bg-red-100 text-red-700":"bg-yellow-100 text-yellow-700"])},[e[6]||(e[6]=x(" Браслет: ",-1)),l("span",W,i(n.value),1),x(". "+i(s.value),1)],2),l("div",G,[e[8]||(e[8]=l("h4",{class:"text-lg font-bold mb-3"},"1. Привязать к существующему",-1)),b(l("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),class:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 mb-4"},[e[7]||(e[7]=l("option",{value:null,disabled:""},"-- Выберите ребенка --",-1)),(g(!0),v(U,null,q(y.value,t=>(g(),v("option",{key:t.id,value:t.id},i(t.name)+" (Группа: "+i(t.group_id||"Нет")+") ",9,H))),128))],512),[[T,r.value]]),l("button",{onClick:_,disabled:!r.value||u.value,class:f(["w-full py-2 rounded-md text-white font-semibold transition-colors",!r.value||u.value?"bg-gray-400 cursor-not-allowed":"bg-indigo-600 hover:bg-indigo-700"])},i(u.value?"Привязка...":"Привязать браслет"),11,J)]),l("div",K,[e[13]||(e[13]=l("h4",{class:"text-lg font-bold mb-3"},"2. Создать нового ребенка и привязать",-1)),l("form",{onSubmit:E($,["prevent"]),class:"space-y-3"},[l("div",null,[e[9]||(e[9]=l("label",{for:"name",class:"block text-sm font-medium text-gray-700"},"Имя:",-1)),b(l("input",{type:"text",id:"name","onUpdate:modelValue":e[1]||(e[1]=t=>o.name=t),required:"",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"},null,512),[[w,o.name]])]),l("div",null,[e[10]||(e[10]=l("label",{for:"age",class:"block text-sm font-medium text-gray-700"},"Возраст:",-1)),b(l("input",{type:"number",id:"age","onUpdate:modelValue":e[2]||(e[2]=t=>o.age=t),min:"0",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"},null,512),[[w,o.age,void 0,{number:!0}]])]),l("div",null,[e[11]||(e[11]=l("label",{for:"group_id",class:"block text-sm font-medium text-gray-700"},"Группа (номер):",-1)),b(l("input",{type:"number",id:"group_id","onUpdate:modelValue":e[3]||(e[3]=t=>o.group_id=t),min:"1",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2"},null,512),[[w,o.group_id,void 0,{number:!0}]])]),l("div",O,[b(l("input",{type:"checkbox",id:"schwimmer","onUpdate:modelValue":e[4]||(e[4]=t=>o.schwimmer=t),class:"h-4 w-4 text-indigo-600 border-gray-300 rounded"},null,512),[[N,o.schwimmer]]),e[12]||(e[12]=l("label",{for:"schwimmer",class:"ml-2 block text-sm text-gray-900"},"Пловец (Schwimmer)",-1))]),l("button",{type:"submit",disabled:!o.name||m.value,class:f(["w-full py-2 rounded-md text-white font-semibold transition-colors",!o.name||m.value?"bg-gray-400 cursor-not-allowed":"bg-green-600 hover:bg-green-700"])},i(m.value?"Создание...":"Создать и Привязать Браслет"),11,P)],32)]),l("button",{onClick:e[5]||(e[5]=t=>D(p).push("/main/scan")),class:"mt-6 text-sm text-gray-500 hover:text-indigo-600"}," ← Назад к сканированию ")]))]))}},Z=I(Q,[["__scopeId","data-v-8a54e5e8"]]);export{Z as default};
