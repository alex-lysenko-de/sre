import{g as e,a as t,h as a,j as l,k as s,l as r,n as o,z as n,q as i,t as d,F as u,y as c,A as p,o as m}from"./vue-vendor-DH3SoYu2.js";import{u as x}from"./index-DnSONjdv.js";import{g}from"./supabase-DJmvsvGB.js";import{r as v}from"./qrcode-BqwfzOFP.js";import{_ as y}from"./_plugin-vue_export-helper-BCo6x5W8.js";const b=g(v()),f={class:"min-h-screen bg-gray-50 py-8 px-4"},h={class:"max-w-4xl mx-auto"},w={class:"bg-white rounded-lg shadow-md p-6 mb-6"},k={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},C=["disabled"],j={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24"},_={key:1},F={key:2},z={key:0,class:"bg-white rounded-lg shadow-md p-6 mb-6"},R={class:"flex flex-col items-center"},U={class:"bg-white p-6 rounded-lg border-4 border-indigo-600 mb-4"},T={class:"w-full mb-4"},q={class:"flex"},M=["value"],S={class:"w-full bg-blue-50 border border-blue-200 rounded-lg p-4"},V={class:"flex items-start"},A={class:"flex-1"},B={class:"mt-2 text-sm text-blue-800 space-y-1"},H={class:"bg-white rounded-lg shadow-md p-6"},I={class:"overflow-x-auto"},O={class:"w-full"},Q={class:"divide-y divide-gray-200"},D={class:"px-4 py-3 text-sm text-gray-900"},E={class:"px-4 py-3 text-sm"},P={class:"px-4 py-3 text-sm text-gray-600"},J={class:"px-4 py-3 text-sm"},L={class:"px-4 py-3 text-sm"},N=["onClick"],G=y(e({__name:"AdminPanel",setup(e){const{apiRequest:g}=x(),v=t("user"),y=t(24),G=t(!1),$=t(null),K=t(null),W=t([]);async function X(){G.value=!0;try{const e=await g("/invite/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:v.value,expiresInHours:y.value})}),t=await e.json();$.value={...t,role:v.value},await async function(e){if(!K.value)return;try{await b.toCanvas(K.value,e,{width:256,margin:2,color:{dark:"#4F46E5",light:"#FFFFFF"}})}catch(t){}}(t.inviteUrl)}catch(e){alert("Ошибка при создании invite")}finally{G.value=!1}}async function Y(){if(!K.value)return;const e=document.createElement("a");e.download=`invite-qr-${Date.now()}.png`,e.href=K.value.toDataURL(),e.click()}function Z(e){return new Date(e).toLocaleString("ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}return a(()=>{!async function(){try{const e=await g("/users",{method:"GET"}),t=await e.json();W.value=t.users||[]}catch(e){}}()}),(e,t)=>(m(),l("div",f,[s("div",h,[t[20]||(t[20]=s("div",{class:"bg-white rounded-lg shadow-md p-6 mb-6"},[s("h1",{class:"text-3xl font-bold text-gray-900"},"Админ-панель"),s("p",{class:"text-gray-600 mt-2"},"Управление пользователями и генерация QR-кодов")],-1)),s("div",w,[t[8]||(t[8]=s("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Создать Invite",-1)),s("div",k,[s("div",null,[t[4]||(t[4]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Роль ",-1)),o(s("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>v.value=e),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},[...t[3]||(t[3]=[s("option",{value:"user"},"Пользователь",-1),s("option",{value:"admin"},"Администратор",-1)])],512),[[n,v.value]])]),s("div",null,[t[6]||(t[6]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Срок действия ",-1)),o(s("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},[...t[5]||(t[5]=[s("option",{value:1},"1 час",-1),s("option",{value:24},"24 часа",-1),s("option",{value:72},"3 дня",-1),s("option",{value:168},"7 дней",-1)])],512),[[n,y.value]])])]),s("button",{onClick:X,disabled:G.value,class:"w-full py-3 px-4 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center"},[G.value?(m(),l("svg",j,[...t[7]||(t[7]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):r("",!0),G.value?(m(),l("span",F,"Генерация...")):(m(),l("span",_,"Создать QR-код"))],8,C)]),$.value?(m(),l("div",z,[t[17]||(t[17]=s("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"QR-код сгенерирован",-1)),s("div",R,[s("div",U,[s("canvas",{ref_key:"qrCanvas",ref:K,class:"w-64 h-64"},null,512)]),s("div",T,[t[10]||(t[10]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Ссылка для регистрации ",-1)),s("div",q,[s("input",{value:$.value.inviteUrl,readonly:"",class:"flex-1 px-4 py-2 border border-gray-300 rounded-l-lg bg-gray-50 text-sm"},null,8,M),s("button",{onClick:t[2]||(t[2]=e=>{return t=$.value.inviteUrl,void navigator.clipboard.writeText(t).then(()=>{alert("Скопировано в буфер обмена!")});var t}),class:"px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-r-lg transition",title:"Копировать"},[...t[9]||(t[9]=[s("svg",{class:"w-5 h-5 text-gray-700",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1)])])])]),s("div",S,[s("div",V,[t[15]||(t[15]=s("svg",{class:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[s("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),s("div",A,[t[14]||(t[14]=s("h4",{class:"text-sm font-medium text-blue-900"},"Информация",-1)),s("ul",B,[s("li",null,[t[11]||(t[11]=i("• Роль: ",-1)),s("strong",null,d("admin"===$.value.role?"Администратор":"Пользователь"),1)]),s("li",null,[t[12]||(t[12]=i("• Истекает: ",-1)),s("strong",null,d(Z($.value.expiresAt)),1)]),t[13]||(t[13]=s("li",null,"• Можно использовать только один раз",-1))])])])]),s("button",{onClick:Y,class:"mt-4 px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition flex items-center"},[...t[16]||(t[16]=[s("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),i(" Скачать QR-код ",-1)])])])])):r("",!0),s("div",H,[t[19]||(t[19]=s("h2",{class:"text-xl font-semibold text-gray-900 mb-4"},"Пользователи",-1)),s("div",I,[s("table",O,[t[18]||(t[18]=s("thead",{class:"bg-gray-50"},[s("tr",null,[s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Имя"),s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Роль"),s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Последний вход"),s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Статус"),s("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Действия")])],-1)),s("tbody",Q,[(m(!0),l(u,null,c(W.value,e=>(m(),l("tr",{key:e.id,class:"hover:bg-gray-50"},[s("td",D,d(e.display_name),1),s("td",E,[s("span",{class:p(["admin"===e.role?"bg-purple-100 text-purple-800":"bg-blue-100 text-blue-800","px-2 py-1 rounded-full text-xs font-medium"])},d("admin"===e.role?"Админ":"Пользователь"),3)]),s("td",P,d(e.last_seen_date?Z(e.last_seen_date):"Никогда"),1),s("td",J,[s("span",{class:p([e.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 rounded-full text-xs font-medium"])},d(e.active?"Активен":"Заблокирован"),3)]),s("td",L,[s("button",{onClick:t=>async function(e){try{await g("/user/toggle-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e.id,active:!e.active})}),e.active=!e.active}catch(t){alert("Ошибка при изменении статуса пользователя")}}(e),class:"text-indigo-600 hover:text-indigo-900 font-medium"},d(e.active?"Заблокировать":"Активировать"),9,N)])]))),128))])])])])])]))}}),[["__scopeId","data-v-acae80aa"]]);export{G as default};
